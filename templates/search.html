{% extends "base.html" %}

{% block title %}Поиск{% endblock %}

{% load static %}

{% block links %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Red+Rose:wght@700&display=swap" rel="stylesheet">
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/script.js' %}"></script>
{% endblock %}

{% block content %}
    <section class="header">
        <a href="/accounts/login" class="login">login</a>
        <div class="notifications"><svg version="1.1" id="notif" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            viewBox="0 0 416 416" style="enable-background:new 0 0 416 416;" xml:space="preserve"><g><g><g><path d="M208,416c23.573,0,42.667-19.093,42.667-42.667h-85.333C165.333,396.907,184.427,416,208,416z"/><path d="M336,288V181.333c0-65.6-34.88-120.32-96-134.827V32c0-17.707-14.293-32-32-32s-32,14.293-32,32v14.507c-61.12,14.507-96,69.227-96,134.827V288l-42.667,42.667V352h341.333v-21.333L336,288z"/></g></g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
            <div class="notif_list" id="notif_list">
                <a href="#">
                    <span class="notif_elem">У вас новый комментарий</span>
                </a>
                <a href="#">
                    <span class="notif_elem">Вашу фотографию оценили</span>
                </a>
                <a href="#">
                    <span class="notif_elem">У вас новый комментарий</span>
                </a>
            </div>
        </div>
    </section>
    <section class="content">
        <div class="toggle">
            <span></span>
        </div>
        <section class="navbar">
            <a href="/" class="navbar_elem">
                <svg version="1.1" id="house" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"width="40px" height="40px" viewBox="0 0 460.298 460.297" style="enable-background:new 0 0 460.298 460.297;"xml:space="preserve"><g><g><path d="M230.149,120.939L65.986,256.274c0,0.191-0.048,0.472-0.144,0.855c-0.094,0.38-0.144,0.656-0.144,0.852v137.041c0,4.948,1.809,9.236,5.426,12.847c3.616,3.613,7.898,5.431,12.847,5.431h109.63V303.664h73.097v109.64h109.629c4.948,0,9.236-1.814,12.847-5.435c3.617-3.607,5.432-7.898,5.432-12.847V257.981c0-0.76-0.104-1.334-0.288-1.707L230.149,120.939z"/><path d="M457.122,225.438L394.6,173.476V56.989c0-2.663-0.856-4.853-2.574-6.567c-1.704-1.712-3.894-2.568-6.563-2.568h-54.816c-2.666,0-4.855,0.856-6.57,2.568c-1.711,1.714-2.566,3.905-2.566,6.567v55.673l-69.662-58.245c-6.084-4.949-13.318-7.423-21.694-7.423c-8.375,0-15.608,2.474-21.698,7.423L3.172,225.438c-1.903,1.52-2.946,3.566-3.14,6.136c-0.193,2.568,0.472,4.811,1.997,6.713l17.701,21.128c1.525,1.712,3.521,2.759,5.996,3.142c2.285,0.192,4.57-0.476,6.855-1.998L230.149,95.817l197.57,164.741c1.526,1.328,3.521,1.991,5.996,1.991h0.858c2.471-0.376,4.463-1.43,5.996-3.138l17.703-21.125c1.522-1.906,2.189-4.145,1.991-6.716C460.068,229.007,459.021,226.961,457.122,225.438z"/></g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
            </a>
            <a href="/search" class="navbar_elem">
                <svg version="1.1" id="search" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 192.904 192.904" style="enable-background:new 0 0 192.904 192.904;" xml:space="preserve"><path d="M190.707,180.101l-47.078-47.077c11.702-14.072,18.752-32.142,18.752-51.831C162.381,36.423,125.959,0,81.191,0C36.422,0,0,36.423,0,81.193c0,44.767,36.422,81.187,81.191,81.187c19.688,0,37.759-7.049,51.831-18.751l47.079,47.078c1.464,1.465,3.384,2.197,5.303,2.197c1.919,0,3.839-0.732,5.304-2.197C193.637,187.778,193.637,183.03,190.707,180.101z M15,81.193C15,44.694,44.693,15,81.191,15c36.497,0,66.189,29.694,66.189,66.193c0,36.496-29.692,66.187-66.189,66.187C44.693,147.38,15,117.689,15,81.193z"/><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
            </a>
            <div class="navbar_info">
                <span><a href="/">home</a></span>
                <span><a href="/search">search</a></span>
            </div>
        </section>
        <div class="center">
            <div class="center">
                <div class="search-data">
                    <div class="age-gap">
                        <div class="age-gap-title">Возраст</div>
                        <span>От:</span>
                        <input type="number" name="" id="" min="18" max="110">
                        <span>До:</span>
                        <input type="number" name="" id="" min="18" max="110">
                    </div>
                    <div class="rating-gap">
                        <div class="rating-gap-title">Рейтинг</div>
                        <span>От:</span>
                        <input type="number" name="" id="" min="0" max="110">
                        <span>До:</span>
                        <input type="number" name="" id="" min="1000" max="110">
                    </div>
                    <div class="location">
                        <div class="location-gap-title">Местоположение:</div>
                        <input type="text" name="" id="">
                    </div>
                    <div class="interests">
                        <div class="rating-gap-title">Интересы:</div>
                        <div id="tags" class="search-tags"></div>
                    </div>
                </div>
            </div>
            <div class="center">
                <section class="user-profile user-profile-short">
                    <figure>
                        <div>
                            <img src="{% static 'img/default.png' %}" alt="default profile picture">
                        </div>
                        <div class="not-here-pls" id="del-avatar" style="display: none;">
                            <span class="not-here-pls">&#10008;</span>
                        </div>
                        <div id="connection">online</div>
                    </figure>
                    <!-- <div class="buttons">
                        <div class="chat"></div>
                        <div class="block"></div>
                        <div class="connect"></div>
                    </div> -->
                    <section class="user-data">
                        <div id="username"><span>cnails</span></div>
                        <div id="name">
                            <span>Иван Иванов</span>
                        </div>
                        <div id="rating">Рейтинг: <span>420&#9733;</span></div>
                        <div>
                            <button id="show-more">показать полностью</button>
                            <div id="history" class="short-history">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Qui tempora ipsum enim delectus officia tenetur cum, vitae ad eos aliquid incidunt numquam voluptatem nobis! Doloremque itaque laudantium architecto eius illo. Lorem ipsum dolor sit amet consectetur adipisicing elit. Soluta dolorum, iste inventore asperiores eaque aliquid dicta odio, est ipsa ad quam vel officia, magni tenetur rem explicabo at eligendi deleniti!</div>
                        </div>
                        <section class="interests">
                            <div id="tags">
                                <div class="tag">
                                    <span>#рисование</span>
                                </div>
                                <div class="tag">
                                    <span>#плавание</span>
                                </div>
                                <div class="tag">
                                    <span>#программирование</span>
                                </div>
                                <div class="tag">
                                    <span>#шахматы</span>
                                </div>
                                <div class="tag">
                                    <span>#математика</span>
                                </div>
                            </div>
                        </section>
                    </section>
                    <section class="images">
                        <div class="img-area">
                            <div>
                                <img id="output" style="display: none;">
                            </div>
                        </div>
                        <input type="file" id="imageInput" class="not-here-pls"name="imageInput" accept=".jpg, .jpeg, .png" onchange="image.loadFile(event)">
                        <label style="display: none;" for="imageInput" class="not-here-pls" id="image-input">
                            <svg version="1.1" id="Capa_1" class="not-here-pls" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 477.863 477.863" style="enable-background:new 0 0 477.863 477.863;" xml:space="preserve"><g><g><path d="M409.598,153.596h-85.333c-9.426,0-17.067,7.641-17.067,17.067s7.641,17.067,17.067,17.067h85.333c9.426,0,17.067,7.641,17.067,17.067v221.867c0,9.426-7.641,17.067-17.067,17.067H68.265c-9.426,0-17.067-7.641-17.067-17.067V204.796c0-9.426,7.641-17.067,17.067-17.067h85.333c9.426,0,17.067-7.641,17.067-17.067s-7.641-17.067-17.067-17.067H68.265c-28.277,0-51.2,22.923-51.2,51.2v221.867c0,28.277,22.923,51.2,51.2,51.2h341.333c28.277,0,51.2-22.923,51.2-51.2V204.796C460.798,176.519,437.875,153.596,409.598,153.596z"/></g></g><g><g><path d="M336.331,90.33L250.998,4.997c-6.664-6.663-17.468-6.663-24.132,0L141.532,90.33c-6.548,6.78-6.36,17.584,0.42,24.132c6.614,6.388,17.099,6.388,23.713,0l56.201-56.201V341.33c0,9.426,7.641,17.067,17.067,17.067s17.067-7.641,17.067-17.067V58.262l56.201,56.201c6.78,6.548,17.584,6.36,24.132-0.42C342.719,107.429,342.719,96.944,336.331,90.33z"/></g></g></svg>
                        </label>
                    </section>
                </section>
            </div>

        </div>
    </section>
{% endblock %}

{% block body_scripts %}
    <script src="{% static 'js/toggleBtn.js' %}"></script>
    <script>
        var new_tag_edited = false;
    
        function submitTag(el) {
            let input = el.querySelector("input");
            try {
                var data = input.value.trim();
            } catch (error) {
                return;
            }
            if (!data) {
                el.remove();
            }
            input.remove();
            el.classList.remove("active-tag");
            el.classList.remove("new-tag");
            if (new_tag_edited) {
                let del_btn = document.createElement("div");
                del_btn.classList.add("del_btn");
                el.appendChild(del_btn);
                tagListener(el);
                createNewTag();
                new_tag_edited = false;
            }
            el.querySelector("span").innerHTML = "#" + data;
            // ЗДЕСЬ НАДО ОТПРАВЛЯТЬ ЗАПРОС О СОЗДАНИИ/ИЗМЕНЕНИИ ТЕГА
        }
    
        function createNewTag() {
            let new_tag = document.createElement("div");
            let span = document.createElement("span");
            let tags_area = document.getElementById("tags");
    
            span.innerHTML = "# ";
            new_tag.classList.add("tag");
            new_tag.classList.add("new-tag");
            new_tag.appendChild(span);
            new_tag.appendChild(document.createElement("input"));
            tags_area.appendChild(new_tag);
            tagListener(new_tag);
        }
    
        function tagListener(el) {
            el.addEventListener("click", function(e) {
                if (!el.classList.contains("active-tag") && !el.classList.contains("new-tag")) {
                    let active = document.querySelector(".active-tag");
                    if (active) {
                        submitTag(active);
                    }
                    el.classList.add("active-tag");
                    let span = el.querySelector("span");
                    let data = span.innerHTML.split("#")[1];
                    span.innerHTML = "# ";
                    let input = document.createElement("input");
                    input.setAttribute("value", data);
                    el.appendChild(input);
                }
            });
            el.addEventListener("input", function(e) {
                if (el.classList.contains("new-tag")) {
                    new_tag_edited = true;
                }
                if (el.classList.contains("new-tag") && el.querySelector("input").value == "") {
                    new_tag_edited = false;
                }
                if (e.data === " ") {
                    submitTag(el);
                }
            });
            el.addEventListener("keypress", function(e) {
                let code = e.keyCode || e.which;
                if (code === 13) {
                    if ((document.querySelector(".search-tags .new-tag") && document.querySelector(".new-tag input").value) || el.classList.contains("active-tag"))
                        submitTag(el);
                }
            });
            try {
                el.querySelector(".del_btn").addEventListener("click", function(e) {
                    el.remove();
                });
            } catch {
            }
        }
    
        function editTag() {
            document.addEventListener("click", function(e) {
                let active_tag = document.querySelector(".active-tag");
                if (active_tag) {
                    if (!(e.target == active_tag || active_tag.contains(e.target))) {
                        submitTag(active_tag);
                    }
                }
            });
            document.querySelectorAll(".interests .tag").forEach(el => {
                tagListener(el);
            });
        }
    
        var tags = {
            edit: function() {
                document.querySelectorAll(".search-tags .tag").forEach(el => {
                    let del_btn = document.createElement("div");
                    del_btn.classList.add("del_btn");
                    el.appendChild(del_btn);
                });
                // change_tag_btn.innerHTML = "&#10004;";
                createNewTag();
                editTag();
                // change_tag = true;
            },
            submit: function() {
                document.querySelectorAll(".search-tags .tag").forEach(el => {
                    try {
                        el.querySelector(".search-tags .del_btn").remove();
                    } catch (error) {
                    }
                });
                document.querySelector(".search-tags .new-tag").remove();
            }
        }
        tags.edit();
    </script>
{% endblock %}
